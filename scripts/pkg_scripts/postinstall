#!/bin/bash
set -euo pipefail

APP_PATH="/Applications/TextPolish.app"
LEGACY_PATH="/Applications/GrammarCorrection.app"

if [[ ! -d "$APP_PATH" ]]; then
  exit 0
fi

if [[ -d "$LEGACY_PATH" && "$LEGACY_PATH" != "$APP_PATH" ]]; then
  /bin/rm -rf "$LEGACY_PATH" >/dev/null 2>&1 || true
fi

CONSOLE_USER="$(/usr/bin/stat -f "%Su" /dev/console || true)"
if [[ -z "$CONSOLE_USER" || "$CONSOLE_USER" == "root" ]]; then
  exit 0
fi

CONSOLE_UID="$(/usr/bin/id -u "$CONSOLE_USER" || true)"
if [[ -z "$CONSOLE_UID" ]]; then
  exit 0
fi

/bin/launchctl asuser "$CONSOLE_UID" /usr/bin/open -a "$APP_PATH" >/dev/null 2>&1 || true
exit 0
